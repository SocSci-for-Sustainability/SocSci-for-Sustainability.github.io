<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Cooperative conservation – Social Science for Sustainability</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./diffusion.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-eac44e41018956f88012b5b01fb4b211.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-09d0fbc9ad20a915fa4847efc57a3950.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-eac44e41018956f88012b5b01fb4b211.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0c073e481e47220cc03c14c6fb9ce08d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-30b6cae2a826812af03821681d41edc7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-0c073e481e47220cc03c14c6fb9ce08d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- header.html -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&amp;family=Source+Code+Pro:wght@400;500;600;700&amp;display=swap">

<script>
document.addEventListener('DOMContentLoaded', function () {
  const buttons = document.querySelectorAll('[data-bs-toggle="popover"]');

  buttons.forEach(btn => {
    const url = btn.getAttribute('data-url');

    if (url) {
      fetch(url)
        .then(response => response.text())
        .then(html => {
          btn.setAttribute('data-bs-content', html);

          // Create the popover AFTER content is loaded
          new bootstrap.Popover(btn);
        });
    } else {
      // Fallback for inline content
      new bootstrap.Popover(btn);
    }
  });
});
</script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    window.setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      window.setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    window.hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(darkModeDefault) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const darkModeDefault = false;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !window.hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
    };
    // Switch to dark mode if need be
    if (window.hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Social Science for Sustainability</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./curriculum.html"> 
<span class="menu-text">Curriculum</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://matphd.substack.com"> 
<span class="menu-text">Subscribe</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./cooperation.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cooperative conservation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./SS4S.key.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quantitative-techniques.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Quantitative Techniques</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diffusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Social Diffusion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cooperation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cooperative conservation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./curriculum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Curriculum &amp; Syllabi</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. <em>Introduction to Social Science for Sustainability</em></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-agent-based-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. <em>Agent-based Modeling</em></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus-opinion-change.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. <em>Opinion Change: Modeling and Measurement</em></span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#cooperation-as-a-correlative-coordination-problem" id="toc-cooperation-as-a-correlative-coordination-problem" class="nav-link active" data-scroll-target="#cooperation-as-a-correlative-coordination-problem"><span class="header-section-number">4.1</span> Cooperation as a correlative coordination problem</a>
  <ul class="collapse">
  <li><a href="#cultural-evolutionary-game-theory" id="toc-cultural-evolutionary-game-theory" class="nav-link" data-scroll-target="#cultural-evolutionary-game-theory"><span class="header-section-number">4.1.1</span> Cultural evolutionary game theory</a></li>
  <li><a href="#inspiration-behind-this-article" id="toc-inspiration-behind-this-article" class="nav-link" data-scroll-target="#inspiration-behind-this-article"><span class="header-section-number">4.1.2</span> Inspiration behind this article</a></li>
  </ul></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model"><span class="header-section-number">4.2</span> Model</a>
  <ul class="collapse">
  <li><a href="#spatial-structure" id="toc-spatial-structure" class="nav-link" data-scroll-target="#spatial-structure"><span class="header-section-number">4.2.1</span> Spatial structure</a></li>
  <li><a href="#sec-social-interaction-and-payoffs" id="toc-sec-social-interaction-and-payoffs" class="nav-link" data-scroll-target="#sec-social-interaction-and-payoffs"><span class="header-section-number">4.2.2</span> Social interaction and payoffs</a></li>
  <li><a href="#selection-for-cooperation-via-social-learning" id="toc-selection-for-cooperation-via-social-learning" class="nav-link" data-scroll-target="#selection-for-cooperation-via-social-learning"><span class="header-section-number">4.2.3</span> Selection for cooperation via social learning</a></li>
  <li><a href="#computational-analysis-design" id="toc-computational-analysis-design" class="nav-link" data-scroll-target="#computational-analysis-design"><span class="header-section-number">4.2.4</span> Computational analysis design</a></li>
  <li><a href="#model-parameters" id="toc-model-parameters" class="nav-link" data-scroll-target="#model-parameters"><span class="header-section-number">4.2.5</span> Model parameters</a></li>
  <li><a href="#computational-analysis-configuration-settings" id="toc-computational-analysis-configuration-settings" class="nav-link" data-scroll-target="#computational-analysis-configuration-settings"><span class="header-section-number">4.2.6</span> Computational analysis configuration settings</a></li>
  <li><a href="#outcome-measures" id="toc-outcome-measures" class="nav-link" data-scroll-target="#outcome-measures"><span class="header-section-number">4.2.7</span> Outcome measures</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">4.2.8</span> Implementation</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis"><span class="header-section-number">4.3</span> Analysis</a>
  <ul class="collapse">
  <li><a href="#when-does-cost-of-cooperation-become-prohibitive" id="toc-when-does-cost-of-cooperation-become-prohibitive" class="nav-link" data-scroll-target="#when-does-cost-of-cooperation-become-prohibitive"><span class="header-section-number">4.3.1</span> When does cost of cooperation become prohibitive?</a></li>
  <li><a href="#when-does-migration-undermine-cooperation" id="toc-when-does-migration-undermine-cooperation" class="nav-link" data-scroll-target="#when-does-migration-undermine-cooperation"><span class="header-section-number">4.3.2</span> When does migration undermine cooperation?</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">4.4</span> Discussion</a></li>
  <li><a href="#sec-exercises" id="toc-sec-exercises" class="nav-link" data-scroll-target="#sec-exercises"><span class="header-section-number">4.5</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-3-reciprocity" id="toc-exercise-3-reciprocity" class="nav-link" data-scroll-target="#exercise-3-reciprocity"><span class="header-section-number">4.5.1</span> Exercise 3: Reciprocity</a></li>
  <li><a href="#exercise-4-interconnected-communities" id="toc-exercise-4-interconnected-communities" class="nav-link" data-scroll-target="#exercise-4-interconnected-communities"><span class="header-section-number">4.5.2</span> Exercise 4: Interconnected communities</a></li>
  </ul></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="header-section-number">4.6</span> Appendix</a>
  <ul class="collapse">
  <li><a href="#sec-valley-water-references" id="toc-sec-valley-water-references" class="nav-link" data-scroll-target="#sec-valley-water-references"><span class="header-section-number">4.6.1</span> CA Central Valley water annotated references and links</a></li>
  <li><a href="#source-code" id="toc-source-code" class="nav-link" data-scroll-target="#source-code"><span class="header-section-number">4.6.2</span> Source code</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cooperative conservation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><br></p>
<p>In California’s Central Valley, farms, orchards, dairies, and other agricultural industries use disproportionately more water than the communities where farm workers live in an increasingly precarious state. Wells increasingly run dry when they aren’t contaminated by deadly chemicals first. The state-level water restriction enforcement agency has recently rejected several plans proposed by local water district planners. All this currently occurs against a backdrop of climate variability and political instability that increasingly drives the migration of farmers and farm workers alike (see <a href="#sec-valley-water-references">CA Central Valley water annotated references and links</a> below). This problem is increasingly acute across diverse societies and aquifers, though in some cases groundwater is being restored to previously overdrawn aquifers <span class="citation" data-cites="Jasechko2024">(<a href="references.html#ref-Jasechko2024" role="doc-biblioref">Jasechko et al. 2024</a>)</span>.</p>
<p>Equitable access to clean potable water depends on cooperation among those sharing groundwater aquifers, consistent with the UN Sustainable Development Goals (SDGs) <a href="https://sdgs.un.org/goals/goal10">to Reduce Inequalities (SDG 10)</a> and <a href="https://sdgs.un.org/goals/goal6">to provide Clean Water and Sanitation (SDG 6)</a>, representing <a href="https://css4s.github.io/abm-notes/intro.html#course-outline-in-the-context-of-sustainable-development">Group I and Group B goals</a> to, in general, support <em>infrastructure</em>/<em>institutions</em> and <em>basic human needs</em>, respectively. Cooperation to sustain groundwater resources is increasingly important since there are more frequent climate change-driven droughts threatening human and non-human life on land. This project, then, also addresses Group E (<em>environmental and ecological protection</em>) Sustainable Development Goals, namely to accelerate relevant <a href="https://sdgs.un.org/goals/goal13">Climate Action (SDG 13)</a>, and to protect the literal bedrock of ecosystems that support all <a href="https://sdgs.un.org/goals/goal15">Life on Land (SDG 15)</a>.</p>
<p>Theoretically, we know that high rates of migration can disrupt the formation of cooperative communities in idealized models of the establishment and diffusion of cooperation to effectively form collectives. However, many theoretical questions remain and existing results have not yet been interpreted for how they could support sustainability in any way, including groundwater sustainability. We therefore develop here a spatial agent-based model of cooperation where agents represent water consumers arranged on a spatial grid. Migration is represented as a random switch of two agents in the grid. <em>Cooperation</em> or its opposite, <em>defection</em>, result in different payoffs depending on which of these two behaviors interaction partners choose. Cooperation can be mutually beneficial, but it comes at the cost of an initial investment that will be uncompensated if a model interaction partner defects. If both individuals defect, i.e., choose to not cooperate, then they may face a <em>disaster debit</em>, i.e., a penalty that could represent, e.g., ecological collapse, external sanctions, or some other form of penalty.</p>
<p>We analyze how migration can break up cooperatives, i.e., blocks of cooperating agents who assort to effectively block out those who intend to defect. We characterize the effect of migration rate for a range of costs of cooperation. This basic analysis lays the groundwork for designing interventions that help maintain cooperation even with frequent migration (see <a href="#sec-exercise-3-delta-for-cooperation-maintenance">Exercise 3</a>).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figures/cooperation-map.png" class="img-fluid figure-img"></p>
<figcaption>Sources. Map: Becker, Rachel (Aug.&nbsp;18, 2021). “California enacted a groundwater law 7 years ago. But wells are still drying up — and the threat is spreading”. Cal Matters. https://calmatters.org/environment/2021/08/california-groundwater-dry. See <a href="#sec-valley-water-references">Contaminated water references</a> below for information on towns marked as persistently reliant on bottled water.</figcaption>
</figure>
</div>
<section id="cooperation-as-a-correlative-coordination-problem" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="cooperation-as-a-correlative-coordination-problem"><span class="header-section-number">4.1</span> Cooperation as a correlative coordination problem</h2>
<p>Cooperation is a correlative coordination problem, meaning that payoffs are maximized when individuals do the same behavior as others. <em>Cooperation</em> dilemmas, in evolutionary game theory on which we draw here, are defined to entail the risk of betrayal, where <em>defectors</em> are those in society who reap the benefit of costly contributions of others, but not contributing anything themselves. The more general <em>correlative coordination</em> problems do not necessarily entail risk of betrayal in the same sense. For example, deciding which side of the street to drive on: it doesn’t matter which side, so long as everyone does that. There is no immediate “cost” to driving on the agreed-to side of the road, only benefit that you’ll be sure to avoid crashing head-on with others, so long as they correlate their behavior with yours, i.e., with some societal norm.</p>
<p>It is costly to cooperate with groundwater pumping limits from the point of view of agricultural producers. For example, less water input might mean lower almond yield and fewer profits in the short term. If enough other orchards defect, this could lead to dry wells, and it would prove to have been unwise to cooperate since defectors made the most money while it lasted, multiplied in effect if defectors evaded accountability for their behavior.</p>
<section id="cultural-evolutionary-game-theory" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="cultural-evolutionary-game-theory"><span class="header-section-number">4.1.1</span> Cultural evolutionary game theory</h3>
<p>Under success-biased learning, culture can be said to <em>evolve</em>. A behavior is like a phenotype, and knowledge of or capacity for a behavior is like genes or alleles that encode a phenotype. Fitness in either case is the benefit received from the phenotype expression.</p>
<p>To study how the prevalence of cooperation varies over time and as <span class="math inline">\(t \to \infty\)</span>, we assume each agent does one of two behaviors: <em>Cooperate</em> or <em>Defect</em>. In our approach here and in many cases, it is unnecessary to represent knowledge of <em>how</em> to cooperate itself, including the acquisition of this knowledge. In other words, doing a behavior implies having already learned how to do it. This strategic abstraction is called the <em>phenotypic gambit</em>, with “gambit” really meaning something more like “assumption”.</p>
</section>
<section id="inspiration-behind-this-article" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="inspiration-behind-this-article"><span class="header-section-number">4.1.2</span> Inspiration behind this article</h3>
<p>One of the goals of this article is to demonstrate <code>socmod</code> use by analyzing a game theory model of cooperation between agents on a spatial grid. The other goal is to motivate the study with a real-world sustainability problem, groundwater conservation. The model and analysis is inspired by Ch. 6 in Paul Smaldino’s book <em>Modeling Social Behavior</em>, including some of the exercises below that Paul includes in his analysis: Paul’s model is written in NetLogo, with analysis and visualizations done in R, it appears. See Paul’s book for how alternative assumptions enable the formal, mathematical analysis of cooperation prevalence in different spatial contexts with migration, as opposed to simulated/generative as done here.</p>
</section>
</section>
<section id="model" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="model"><span class="header-section-number">4.2</span> Model</h2>
<p>The model is implemented in <code>model.R</code>. I show code snippets from that file to illustrate how the model works. Agents are located at grid points in a rectangular 2D lattice, though we use a square lattice with <span class="math inline">\(L=21\)</span> agents per side in our analysis here. Agents play a cooperation game, known as the <em>prisoner’s dilemma</em> game, a common game theory representation of cooperation where a focal agent gets a benefit <span class="math inline">\(b \in [0, \infty)\)</span> if their interaction partner cooperates, but the focal agent pays a cost <span class="math inline">\(-c\)</span> if they choose to cooperate, where <span class="math inline">\(c\in[0, \infty)\)</span>. The payoffs from combinations of the four possible combinations of (Cooperate/Defect) x (Cooperate/Defect) for the dyad define the game’s <em>payoff matrix</em> (<a href="#tbl-payoff-matrix" class="quarto-xref">Table&nbsp;<span>4.1</span></a>).</p>
<section id="spatial-structure" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="spatial-structure"><span class="header-section-number">4.2.1</span> Spatial structure</h3>
<p>Spatial structure, we hypothesize, provides the substrate for cooperation to take hold since neighbors can form spatially organized <em>cooperatives</em>, i.e., clusters of contiguous, connected cooperators. We represent spatial structure by locating agent nodes in a two-dimensional lattice graph we set to be square with side length <span class="math inline">\(L\)</span>, so the agent population size is <span class="math inline">\(N = L^2\)</span>. The model grid can be rectangular in general, and it is left as an exercise to the reader to test what happens when <span class="math inline">\(N\)</span> is held constant but the aspect ratio of the grid is varied, i.e., the width divided by the height.</p>
<p>First consider a grid with <span class="math inline">\(L=6\)</span> agents per side, so <span class="math inline">\(N=36\)</span> population size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/cooperation/model.R"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>L <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>plot_example_adoptnet <span class="ot">&lt;-</span> <span class="cf">function</span>(abm, <span class="at">layout =</span> igraph<span class="sc">::</span><span class="fu">on_grid</span>()) {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_network_adoption</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    abm, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">layout =</span> layout,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">behaviors =</span> <span class="fu">c</span>(<span class="st">"Cooperate"</span>, <span class="st">"Defect"</span>), </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">behavior_colors =</span> <span class="fu">c</span>(<span class="st">"#0486C1"</span>, <span class="st">"#D38855"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Using defaults coop_benefit = 1.0 and coop_cost = 0.2</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>abm <span class="ot">&lt;-</span> <span class="fu">make_cooperation_model</span>(<span class="at">grid_width =</span> L, <span class="at">grid_height =</span> L)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_example_adoptnet</span>(abm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cooperation_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="369"></p>
</figure>
</div>
</div>
</div>
<p>We can make a rectangle with the same number of agents like so</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>abm <span class="ot">&lt;-</span> <span class="fu">make_cooperation_model</span>(<span class="at">grid_width =</span> <span class="dv">9</span>, <span class="at">grid_height =</span> <span class="dv">4</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_example_adoptnet</span>(abm, <span class="at">layout =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cooperation_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="398"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-social-interaction-and-payoffs" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="sec-social-interaction-and-payoffs"><span class="header-section-number">4.2.2</span> Social interaction and payoffs</h3>
<p>Agents interact with all of their neighbors on each time step, collecting payoffs according to whether an agent and each neighbor is currently doing the “Cooperate” or “Defect” behavior, or equivalently whether each agent is a cooperator or defector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Have the focal_agent play the coordination game with all neighbors</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>play_game_with_neighbors <span class="ot">&lt;-</span> <span class="cf">function</span>(focal_agent, model) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Focal agent plays game with neighbors, accumulating payoffs</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  total_payoff <span class="ot">&lt;-</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">unlist</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Use the Neighbors$map function to play with all neighbors</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      focal_agent<span class="sc">$</span><span class="fu">get_neighbors</span>()<span class="sc">$</span><span class="fu">map</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        \(n) <span class="fu">play_game</span>(focal_agent, n, model)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Focal agent's fitness gets set to the total_payoff</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  focal_agent<span class="sc">$</span>fitness_current <span class="ot">&lt;-</span> total_payoff</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>They receive payoffs resulting from <code>play_game</code>, which are given in <a href="#tbl-payoff-matrix" class="quarto-xref">Table&nbsp;<span>4.1</span></a> in terms of the benefit to cooperation, <span class="math inline">\(\beta\)</span>, the cost of cooperation, <span class="math inline">\(\gamma\)</span>, and the disaster debit <span class="math inline">\(-\delta\)</span>, where <span class="math inline">\(\beta,\gamma,\delta \in [0, \infty)\)</span>. For our initial study here we will set <span class="math inline">\(\delta = 0\)</span>, leaving an examination of how cooperation prevalence is affected for different values of <span class="math inline">\(\delta &gt; 0\)</span> as an exercise.</p>
<div id="tbl-payoff-matrix" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-payoff-matrix-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.1: Payoff matrix in dyadic interactions to focal agent, <span class="math inline">\(i\)</span>, whose behavior is read across rows.
</figcaption>
<div aria-describedby="tbl-payoff-matrix-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Focal <span class="math inline">\(\downarrow\quad\quad\)</span> Partner <span class="math inline">\(\rightarrow\)</span></th>
<th><span class="math inline">\(b_j = \text{Cooperate}\)</span></th>
<th><span class="math inline">\(b_j = \text{Defect}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(b_i = \text{Cooperate}\)</span></td>
<td><span class="math inline">\(\beta - \gamma\)</span></td>
<td><span class="math inline">\(-\gamma\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(b_i = \text{Defect}\)</span></td>
<td><span class="math inline">\(\beta\)</span></td>
<td><span class="math inline">\(-\delta\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The <code>play_game</code> function is defined as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Two individuals play game with one another; b = coop_benefit, c = coop_cost</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>play_game <span class="ot">&lt;-</span> <span class="cf">function</span>(focal_agent, partner_agent, model) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    model<span class="sc">$</span>payoff_matrix[</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      focal_agent<span class="sc">$</span>behavior_current,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      partner_agent<span class="sc">$</span>behavior_current</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="selection-for-cooperation-via-social-learning" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="selection-for-cooperation-via-social-learning"><span class="header-section-number">4.2.3</span> Selection for cooperation via social learning</h3>
<p>We implement success-biased learning here in a custom <code>model_step</code> function called <code>coop_model_step</code> used as the sole defining function for the <code>LearningStrategy</code> I call <code>coop_game_strategy</code>. <code>coop_game_strategy</code> uses <code>NULL</code> functions for <code>partner_selection</code>, since agents interact with all neighbors, and also for <code>interaction</code>, since agents accumulate payoffs over all interactions with neighbors. Both of these are implemented in the <code>coop_model_step</code> function that defines this learning strategy’s <code>model_step</code> named constructor parameter (full definition of <code>coop_model_step</code> is <a href="#sec-coop-model-step">given in the Appendix</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For this normal game in this format we don't have individual partner selection </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and interaction steps. Instead all is handled in the model_step, </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e., coop_model_step defined below</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>coop_game_strategy <span class="ot">&lt;-</span> <span class="fu">make_learning_strategy</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">partner_selection =</span> \(f, m) <span class="cn">NULL</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">interaction =</span> \(f, p, m) <span class="cn">NULL</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_step =</span> coop_model_step,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"Normal game strategy"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="computational-analysis-design" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="computational-analysis-design"><span class="header-section-number">4.2.4</span> Computational analysis design</h3>
<p>To analyze how cooperation cost and migration rate affect the emergence of cooperatives in a spatial grid, we systematically vary these variables (<a href="#tbl-params" class="quarto-xref">Table&nbsp;<span>4.2</span></a>) and observe the dynamics of cooperation prevalence over time and our main outcome measure, the prevalence of cooperators at <span class="math inline">\(t=50\)</span>, <span class="math inline">\(p_C(t=50)\)</span> (<a href="#tbl-outcome-measures" class="quarto-xref">Table&nbsp;<span>4.4</span></a>). Specifically we first vary the cost of cooperation, <span class="math inline">\(\gamma\)</span>, setting the migration rate <span class="math inline">\(\mu = 0.0\)</span>, and observe the results. Second, we vary <span class="math inline">\(\mu\)</span>, setting <span class="math inline">\(\gamma = 0.2\)</span>, and observe the results.</p>
</section>
<section id="model-parameters" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="model-parameters"><span class="header-section-number">4.2.5</span> Model parameters</h3>
<p>The model parameters specify how agent learning and migration behavior work. They also set the size of the grid, which indirectly sets the number of agents. We systematically vary two of these, <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\mu\)</span>, and observe the dynamics and outcomes to implement our computational experiments.</p>
<div id="tbl-params" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.2: <strong>Model parameter descriptions and settings.</strong> Values in italic indicate suggested “starter values” to begin development. Bold are the default values in the analyses we present here.
</figcaption>
<div aria-describedby="tbl-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 43%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
<th>Values / Range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\gamma\)</span></td>
<td>Cost to cooperate</td>
<td>0.0, 0.1, <strong>0.2</strong>, 0.249, 0.25, 0.3</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\mu\)</span></td>
<td>Migration rate</td>
<td><strong>0.0</strong>, 0.025, 0.05, …, 0.175, 0.2</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\beta\)</span></td>
<td>Benefit when partner cooperates</td>
<td>1.0</td>
</tr>
<tr class="even">
<td><span class="math inline">\(L\)</span></td>
<td>Agents per row/grid length</td>
<td><em>5</em>, <em>10</em>, <strong>20</strong></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(N\)</span></td>
<td>Number of agents <span class="math inline">\(N=L^2\)</span></td>
<td><strong>400</strong></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="computational-analysis-configuration-settings" class="level3" data-number="4.2.6">
<h3 data-number="4.2.6" class="anchored" data-anchor-id="computational-analysis-configuration-settings"><span class="header-section-number">4.2.6</span> Computational analysis configuration settings</h3>
<p>There are additional parameters that specify how simulation trials work (<a href="#tbl-trials-config" class="quarto-xref">Table&nbsp;<span>4.3</span></a>). In our analysis of outcome variable <span class="math inline">\(p_C(t)\)</span>, we run many simulations for each outcome type, dynamics or long-time “equilibrium” outcomes. We use <span class="math inline">\(t=50\)</span> for the final time step and 20 trials per parameter setting in the outcome analyses below. For the . When developing the full output results, it is often useful to start with smaller values for each of these, with potential development values represented with italic font in <a href="#tbl-trials-config" class="quarto-xref">Table&nbsp;<span>4.3</span></a>.</p>
<div id="tbl-trials-config" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-trials-config-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.3: <strong>Computational analysis configuration parameter descriptions and settings.</strong> Values in italic indicate suggested “starter values” to begin development. Bold are the default values in the analyses we present here.
</figcaption>
<div aria-describedby="tbl-trials-config-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Description</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Final time step of simulation</td>
<td><em>20</em>, <strong>50</strong></td>
</tr>
<tr class="even">
<td>Number of trials per parameter setting</td>
<td><em>3</em>, <em>5</em>, <strong>20</strong></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outcome-measures" class="level3" data-number="4.2.7">
<h3 data-number="4.2.7" class="anchored" data-anchor-id="outcome-measures"><span class="header-section-number">4.2.7</span> Outcome measures</h3>
<p>We measure cooperator prevalence over time to compare its dynamics for different parameter settings. We also extract the prevalence at the end of each trial and aggregate across trials for different parameter settings to estimate the average equilibrium value, or range of equilibria values, of the dynamics as <span class="math inline">\(t \to \infty\)</span> (<a href="#tbl-outcome-measures" class="quarto-xref">Table&nbsp;<span>4.4</span></a>).</p>
<div id="tbl-outcome-measures" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outcome-measures-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.4: <strong>Outcome measures, description, and range.</strong> We observe cooperator prevalence dynamics and analyze the final apprixmate equilibrium prevalence at <span class="math inline">\(t=T\)</span>.
</figcaption>
<div aria-describedby="tbl-outcome-measures-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 43%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Outcome measure</th>
<th>Description</th>
<th>Values / Range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(p_C(t)\)</span></td>
<td>Cooperator prevalence over time</td>
<td><span class="math inline">\([0.0, 1.0]\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(p_C(t=T=50),\)</span> <span class="math inline">\(\langle p_C(T)\rangle\)</span></td>
<td>Cooperator prevalence and average prevalence across trials at <span class="math inline">\(t=T\)</span>, using <span class="math inline">\(T=50\)</span> here</td>
<td><span class="math inline">\([0.0, 1.0]\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="implementation" class="level3" data-number="4.2.8">
<h3 data-number="4.2.8" class="anchored" data-anchor-id="implementation"><span class="header-section-number">4.2.8</span> Implementation</h3>
<p>Simulation trial runs and output analysis were performed primarily using <code>socmod</code>, <code>igraph</code>, <code>ggplot2</code>, and other <code>tidyverse</code> packages, primarily <code>dplyr</code> for data manipulation and analysis and <code>purrr</code> for functional programming.</p>
<p>See <code>run_trials.R</code> for the simulation trial run methods and <code>run_analysis.R</code> that implements the visualizations and other analyses. All source code is available via the GitHub repository for this article: <a href="https://github.com/CSS4S/cooperation-model-socmod">cooperation-model-socmod</a>.</p>
</section>
</section>
<section id="analysis" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="analysis"><span class="header-section-number">4.3</span> Analysis</h2>
<p>To understand how the perceived risk or cost of cooperation and the mutation rate each affect the emergence of cooperation, we examined how cooperation cost and migration rate separately affect the emergence and maintenance of cooperation in simulated populations. We confirmed computationally that at or beyond critical cooperation cost, <span class="math inline">\(\gamma_c = \beta / 4\)</span>, stable cooperatives cannot form, the defect behavior fixates, and cooperation goes extinct (<a href="#fig-transition-conditions" class="quarto-xref">Figure&nbsp;<span>4.1</span></a> A). A similar analysis of a minimal five-agent “cross” or “plus” cooperative is unstable if <span class="math inline">\(2\beta &gt; 4\beta - 4\gamma\)</span>, i.e., if <span class="math inline">\(\gamma &gt; \beta / 2\)</span> (<a href="#fig-transition-conditions" class="quarto-xref">Figure&nbsp;<span>4.1</span></a> B). This explains why we observe such a sharp transition from widespread cooperation to zero cooperation.</p>
<div id="fig-transition-conditions" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-transition-conditions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/transition-conditions.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="650">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-transition-conditions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: <strong>Defector-turns-cooperator and cooperator-turns defector conditions in the founding and destruction of cooperatives.</strong> Three cooperators in a line will result in new cooperators adjacent to the middle node of the triad if the cost of cooperation is less one quarter of the cooperation benefit, i.e., <span class="math inline">\(\gamma &lt; \gamma_c = \beta / 4\)</span> (A). A five-agent “cross” cooperative is unstable if the cost of cooperation is greater than half of the benefit: <span class="math inline">\(\gamma &gt; \beta / 2\)</span>.
</figcaption>
</figure>
</div>
<section id="when-does-cost-of-cooperation-become-prohibitive" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="when-does-cost-of-cooperation-become-prohibitive"><span class="header-section-number">4.3.1</span> When does cost of cooperation become prohibitive?</h3>
<p>We see that cooperation emerges at various non-zero equilibrium values for cooperation costs up to 0.25, including up to 0.249 (<a href="#fig-cooperation-over-cost" class="quarto-xref">Figure&nbsp;<span>4.3</span></a>)! In our initial conditions with half of the agents starting as cooperators, the prevalence of cooperators decreases initially as the relatively isolated cooperators become defectors (<a href="#fig-cooperation-dynamics" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>). Then more and more agents join nascent cooperatives, so the prevalence eventually begins to increase again. When cooperation cost is 0, the dip is lowest, and cooperatives begin to grow and expand cooperator prevalence to their maximum values earlier on compared to greater cooperation costs with <span class="math inline">\(\gamma &lt; \beta / 4\)</span>.</p>
<div id="fig-cooperation-dynamics" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cooperation-dynamics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/coopcost_prevalence.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cooperation-dynamics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: <strong>Dynamics of cooperator prevalence as a function of cooperation cost.</strong>
</figcaption>
</figure>
</div>
<div id="fig-cooperation-over-cost" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cooperation-over-cost-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/coopcost_outcomes.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cooperation-over-cost-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: <strong>Dynamics of cooperator prevalence as a function of cooperation cost.</strong>
</figcaption>
</figure>
</div>
</section>
<section id="when-does-migration-undermine-cooperation" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="when-does-migration-undermine-cooperation"><span class="header-section-number">4.3.2</span> When does migration undermine cooperation?</h3>
<p>Migration, as hypothesized, can undermine cooperation. Based on our reasoning to explain why cooperation is only supported up to <span class="math inline">\(\gamma = 0.25\)</span>, we see that for cooperators to spread, there must be at least three lined up to seed a cooperative that grows into a cluster of cooperators. For this particular choice of parameters, cooperatives can reliably grow only when the migration rate is less than 0.125 (<a href="#fig-migration-outcomes" class="quarto-xref">Figure&nbsp;<span>4.5</span></a>), but there is high variability in the cooperator prevalence as <span class="math inline">\(\mu\)</span> approaches 0.125, indicating that the cooperatives are unstable (<a href="#fig-migration-dynamics" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>).</p>
<div id="fig-migration-dynamics" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-migration-dynamics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/migration_prevalence_50_steps_usethis.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-migration-dynamics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4: <strong>Cooperator prevalence dynamics as a function of migration rate.</strong>
</figcaption>
</figure>
</div>
<div id="fig-migration-outcomes" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-migration-outcomes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/migration_outcomes.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-migration-outcomes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.5: <strong>Cooperator prevalence at</strong> <span class="math inline">\(t=50\)</span> over migration rate. Cooperator prevalence ends up at majority levels (when)
</figcaption>
</figure>
</div>
</section>
</section>
<section id="discussion" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="discussion"><span class="header-section-number">4.4</span> Discussion</h2>
<p>We found that there exist critical cooperation cost/risk values that, when exceeded, cause cooperation to collapse. If we intend to use these models to promote climate action via sustainable adaptations, then this guides us to focus on (1) the perceived cost or risk of cooperation to farmers and municipalities; and (2) the induced migration patterns induced by climate change and other risk factor in the California groundwater case.</p>
<p>This model made several strategic assumptions to make it tractable to analyze, however these were selected at the exclusion of other factors. See the Exercises below for a review of some details we left out and a guide to exploring alternative assumptions on your own.</p>
<ul>
<li><p>Cultural evolution in agriculture (Waring work) and how cooperatives form <span class="citation" data-cites="Waring2017">(<a href="references.html#ref-Waring2017" role="doc-biblioref">Waring, Goff, and Smaldino 2017</a>)</span>. Social behavior science-inspired field work for ecosystem protection <span class="citation" data-cites="Bujold2020">Bujold, Williamson, and Thulin (<a href="references.html#ref-Bujold2020" role="doc-biblioref">2020</a>)</span>.</p></li>
<li><p>(broader implications) This indicates we should be focusing groundwater recharge on the areas with the most amenable geological qualities for replenishing the groundwater aquifers (Stanford Doerr news brief summarizing Rosemary Knight’s research, <a href="https://sustainability.stanford.edu/news/scientists-map-fastest-pathways-replenishing-central-valley-groundwater">“Scientists map fastest pathways for replenishing Central Valley groundwater”</a>)</p></li>
</ul>
<p>When space structures interactions, large cooperatives can emerge starting from a few pioneer cooperators. The emergence of cooperatives requires that (1) cooperation be cheap, and (2) cooperators remain in cooperatives sufficiently for a sufficiently long time. Our idealized model of space, social interaction, and migration rigorously proved these theoretical claims to be correct. This modeling approach serves as a template for future work with more serious applications. See the <a href="#sec-exercises">Exercises</a> for some ideas on how to extend the model to include ecological disaster penalties when two cooperators interact, and how to represent different size grids with loose connections, creating a sort of small-world network using rewiring.</p>
</section>
<section id="sec-exercises" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="sec-exercises"><span class="header-section-number">4.5</span> Exercises</h2>
<section id="exercise-1-disastrous-defection" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1-disastrous-defection">Exercise 1: Disastrous defection</h4>
<p>How do you think adding a defection disaster penalty, <span class="math inline">\(\delta &gt; 0\)</span>, will affect the prevalence of cooperation in simulations? Develop a computational experiment to investigate how cooperation prevalence is affected for different values of <span class="math inline">\(\delta &gt; 0\)</span>. Hint: use <code>run_trials</code>, specifying, e.g., <code>disaster_debit = c(0.1, 0.25, 0.5, 0.75, 1.0, 1.5, 2.0)</code>, then summarise over <code>disaster_debit</code> in <code>summarise_dynamics</code> or <code>summarise_outcomes</code> and plot, e.g., the mean prevalence at time <span class="math inline">\(t=200\)</span>, or whatever is appropriate.</p>
<p>Do larger values of <span class="math inline">\(\delta\)</span> make cooperation more common? If so, how great must <span class="math inline">\(\delta\)</span> be in order to maintain no-migration cooperation levels for a given migration frequency?</p>
</section>
<section id="exercise-2-the-shape-of-cooperation" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2-the-shape-of-cooperation">Exercise 2: The shape of cooperation</h4>
<ol type="A">
<li>Create a new computational experiment with this model where you hold <span class="math inline">\(N\)</span> constant but vary the aspect ratio of the grid. For example, if we use 1024 agents we can have a square grid, aspect ratio 1, if we use <span class="math inline">\(W=H=\)</span> where <span class="math inline">\(W\)</span> is width and <span class="math inline">\(H\)</span> is height. We can generate several other aspect ratios, as shown in the screenshot below. Approximately the same number of agents also works, for example, a 10x6 or 11x6 rectangle has approximately the same number of agents as 8x8 = 64.</li>
<li>This spatial grid has hard/non-periodic boundaries, i.e., agents at the edge have only three neighbors, and the four corner agents have only two neighbors. What effect would you hypothesize if we made our grid into a <em>tourus</em> which is essentially the 2D surface of a donut so there are no corners or edges. This can be specified using by setting <code>periodic = TRUE</code> in <code>igraph::make_lattice</code> when you specify the ABM graph.</li>
</ol>
<p>If you want a larger population with more aspect ratios, that will take a longer time to run, but provides more possible combinations to test.</p>
<p><img src="Figures/cooperation-exercise3.png" class="img-fluid" width="350"></p>
</section>
<section id="exercise-3-reciprocity" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="exercise-3-reciprocity"><span class="header-section-number">4.5.1</span> Exercise 3: Reciprocity</h3>
<p>Reciprocity can increase selection pressure towards cooperation, whereby agents can adapt their behavior with different partners depending on their cooperation history over several rounds of interactions <span class="citation" data-cites="Nowak2006">(<a href="references.html#ref-Nowak2006" role="doc-biblioref">Nowak 2006</a>)</span>. In other words, an agent will cooperate with those who have cooperated with them in past interactions, but defect against those who have defected agains them. There are many ways this could be implemented. The most famous is called <em>tit-for-tat</em>, which is the strategy where an agent will initially cooperate with a stranger, but if a partner defects against a focal agent, that focal agent will forever defect when partnered with the defecting partner. Implement tit-for-tat as a factor in agent behavior selection strategy, either in place of or in addition to social learning.</p>
</section>
<section id="exercise-4-interconnected-communities" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="exercise-4-interconnected-communities"><span class="header-section-number">4.5.2</span> Exercise 4: Interconnected communities</h3>
<p>There could be cooperation or defection between communities as well as within communities. In this exercise, create two or more independent grids, then connect the grids probabilistically. For example, you might set a <code>between_grid_connect_prob</code> that an edge exists between any two agents/nodes from different grids. How does cooperation change with different numbers and sizes of grids, and between-grid connection probability?</p>
<p>Start with the following demo command to create two grids with different sizes and create a “disjoint union” of the graphs with the <code>%du%</code> command in <code>igraph</code>. One can then rewire the union of the two grids as follows to create interconnected grids.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  igraph<span class="sc">::</span><span class="fu">make_lattice</span>(<span class="at">dimvector=</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>), <span class="at">periodic =</span> <span class="cn">FALSE</span>) <span class="sc">%du%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  igraph<span class="sc">::</span><span class="fu">make_lattice</span>(<span class="at">dimvector=</span><span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">3</span>), <span class="at">periodic =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  igraph<span class="sc">::</span><span class="fu">rewire</span>(igraph<span class="sc">::</span><span class="fu">each_edge</span>(<span class="at">p =</span> <span class="fl">0.025</span>, <span class="at">loops =</span> <span class="cn">FALSE</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set id attribute of graphs so it's in the graph</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(graph)<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">V</span>(graph))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> ggnetwork<span class="sc">::</span><span class="fu">ggnetwork</span>(graph)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    tbl, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">xend=</span>xend, <span class="at">yend=</span>yend)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  ggnetwork<span class="sc">::</span><span class="fu">geom_edges</span>() <span class="sc">+</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  ggnetwork<span class="sc">::</span><span class="fu">geom_nodes</span>(<span class="at">color =</span> <span class="st">"#347754"</span>, <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  ggnetwork<span class="sc">::</span><span class="fu">geom_nodetext</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> id), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cooperation_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="369"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="appendix" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="appendix"><span class="header-section-number">4.6</span> Appendix</h2>
<section id="sec-valley-water-references" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="sec-valley-water-references"><span class="header-section-number">4.6.1</span> CA Central Valley water annotated references and links</h3>
<ul>
<li><p><strong>Teviston:</strong> Well failures; ongoing reliance. <a href="https://www.reuters.com/world/us/california-farm-town-lurches-no-water-polluted-water-2021-11-02/">Reuters</a></p></li>
<li><p><strong>Alpaugh:</strong> Arsenic contamination; ongoing reliance. <a href="https://en.wikipedia.org/wiki/Alpaugh%2C_California">Wikipedia</a></p></li>
<li><p><strong>East Orosi:</strong> Nitrate, arsenic, bacteria; ongoing reliance. <a href="https://en.wikipedia.org/wiki/East_Orosi%2C_California">Wikipedia</a></p></li>
<li><p><strong>Seville:</strong> High nitrates; families spend &gt;10% income. <a href="https://en.wikipedia.org/wiki/Seville%2C_California">Wikipedia</a></p></li>
<li><p><strong>Pixley:</strong> Unsafe tap water; ongoing reliance. <a href="https://www.usnews.com/news/best-states/california/articles/2024-09-10/i-wont-let-them-drink-the-water-the-california-towns-where-clean-drinking-water-is-out-of-reach">US News</a></p></li>
<li><p>Scientists map fastest pathways for replenishing Central Valley groundwater (<a href="https://sustainability.stanford.edu/news/scientists-map-fastest-pathways-replenishing-central-valley-groundwater">Stanford Doerr press release April 17, 2025</a>)</p></li>
<li><p>California cracks down on another Central Valley farm area for groundwater depletion (<a href="https://phys.org/news/2024-09-california-central-valley-farm-area.html">phys.org September 23, 2024</a>)</p></li>
<li><p>State rejects local plans for protecting San Joaquin Valley groundwater (<a href="https://calmatters.org/environment/2021/08/california-groundwater-dry/">Cal Matters March 3, 2023</a>)</p></li>
<li><p>California enacted a groundwater law 7 years ago. But wells are still drying up — and the threat is spreading (<a href="https://calmatters.org/environment/2021/08/california-groundwater-dry/">Cal Matters August 18, 2021</a>)</p></li>
</ul>
</section>
<section id="source-code" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="source-code"><span class="header-section-number">4.6.2</span> Source code</h3>
<section id="make_cooperation_model" class="level4">
<h4 class="anchored" data-anchor-id="make_cooperation_model"><code>make_cooperation_model</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>make_cooperation_model <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">grid_height =</span> <span class="dv">11</span>, <span class="at">grid_width =</span> <span class="dv">11</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">coop_benefit =</span> <span class="fl">1.0</span>, <span class="at">coop_cost =</span> <span class="fl">0.25</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">disaster_cost =</span> <span class="fl">0.0</span>) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set up spatial grid</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">make_lattice</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dimvector =</span> <span class="fu">c</span>(grid_height, grid_width), <span class="at">periodic =</span> <span class="cn">FALSE</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define payoff matrix</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  payoff_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(coop_benefit <span class="sc">-</span> coop_cost, <span class="sc">-</span><span class="fl">1.0</span> <span class="sc">*</span> coop_cost, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      coop_benefit,             disaster_cost),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Focal"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Cooperate"</span>, <span class="st">"Defect"</span>),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Partner"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Cooperate"</span>, <span class="st">"Defect"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialized like Smaldino _MSB_ Ch. 6</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  abm <span class="ot">&lt;-</span> </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">make_abm</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">graph =</span> g, </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">coop_benefit =</span> coop_benefit, </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">coop_cost =</span> coop_cost,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">payoff_matrix =</span> payoff_matrix,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">learning_strategy =</span> normal_game_strategy</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">initialize_agents</span>(<span class="at">initial_prevalence =</span> <span class="fl">0.5</span>,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adaptive_behavior =</span> <span class="st">"Cooperate"</span>,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">legacy_behavior =</span> <span class="st">"Defect"</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (abm)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-coop-model-step" class="level4">
<h4 class="anchored" data-anchor-id="sec-coop-model-step"><code>coop_model_step</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>coop_model_step <span class="ot">&lt;-</span> <span class="cf">function</span>(abm) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Each agent plays game, receiving a total fitness from playing with each neighbor</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">walk</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    abm<span class="sc">$</span>agents,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    \(agent) {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">play_game_with_neighbors</span>(agent, abm)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># After each agent plays, iterate through again to do success-biased learning</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">walk</span>(</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    abm<span class="sc">$</span>agents,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    \(agent) {</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For this application we need to manually check if </span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      neighbors <span class="ot">&lt;-</span> agent<span class="sc">$</span><span class="fu">get_neighbors</span>()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      tot_neighbor_fitnesses <span class="ot">&lt;-</span> </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(<span class="fu">unlist</span>(neighbors<span class="sc">$</span><span class="fu">map</span>(\(n) n<span class="sc">$</span><span class="fu">get_fitness</span>())))</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If all neighbors fitnesses are zero</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (tot_neighbor_fitnesses <span class="sc">==</span> <span class="fl">0.0</span>) {</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        teacher <span class="ot">&lt;-</span> neighbors<span class="sc">$</span><span class="fu">sample</span>()</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        teacher <span class="ot">&lt;-</span> <span class="fu">success_bias_select_teacher</span>(agent, abm)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      agent<span class="sc">$</span><span class="fu">set_next_behavior</span>(teacher<span class="sc">$</span><span class="fu">get_behavior</span>())</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Agent-level fitness resets after each round (i.e. time step in this case)</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>      agent<span class="sc">$</span><span class="fu">set_next_fitness</span>(<span class="fl">0.0</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use socmod-provided model step function for learning given next_behavior/fitness</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">iterate_learning_model</span>(abm)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Bujold2020" class="csl-entry" role="listitem">
Bujold, P. M., K. Williamson, and E. Thulin. 2020. <span>“<span class="nocase">The science of changing behavior for environmental outcomes: A literature review</span>.”</span> <em>Rare Center for Behavior &amp; the Environment and The Scientific and Technical Advisory Panel to the Global Environment Facility</em>, 1–138.
</div>
<div id="ref-Jasechko2024" class="csl-entry" role="listitem">
Jasechko, Scott, Hansjörg Seybold, Debra Perrone, Ying Fan, Mohammad Shamsudduha, Richard G. Taylor, Othman Fallatah, and James W. Kirchner. 2024. <span>“<span class="nocase">Rapid groundwater decline and some cases of recovery in aquifers globally</span>.”</span> <em>Nature</em> 625 (7996): 715–21. <a href="https://doi.org/10.1038/s41586-023-06879-8">https://doi.org/10.1038/s41586-023-06879-8</a>.
</div>
<div id="ref-Nowak2006" class="csl-entry" role="listitem">
Nowak, Martin A. 2006. <span>“<span class="nocase">Evolution of virulence</span>.”</span> In <em>Evolutionary Dynamics: Exploring the Equations of Life</em>, 384. Harvard University Press. <a href="https://doi.org/10.1016/S0891-5520(03)00099-0">https://doi.org/10.1016/S0891-5520(03)00099-0</a>.
</div>
<div id="ref-Waring2017" class="csl-entry" role="listitem">
Waring, Timothy M., Sandra H. Goff, and Paul E. Smaldino. 2017. <span>“<span class="nocase">The coevolution of economic institutions and sustainable consumption via cultural group selection</span>.”</span> <em>Ecological Economics</em> 131: 524–32. <a href="https://doi.org/10.1016/j.ecolecon.2016.09.022">https://doi.org/10.1016/j.ecolecon.2016.09.022</a>.
</div>
</div>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    window.setColorSchemeToggle(window.hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./diffusion.html" class="pagination-link" aria-label="Social Diffusion">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Social Diffusion</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>